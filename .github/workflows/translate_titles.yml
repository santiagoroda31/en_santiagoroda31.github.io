name: Translate Titles and Publish

on:
  push:
    branches:
      - main

jobs:
  translate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install googletrans==4.0.0-rc1

      - name: Translate titles in notas_santiago.json
        run: |
          import json
          from googletrans import Translator

          translator = Translator()
          with open("notas_santiago.json", "r", encoding="utf-8") as f:
              data = json.load(f)

          for item in data:
              item["title"] = translator.translate(item["title"], src="es", dest="en").text

          with open("notas_santiago.json", "w", encoding="utf-8") as f:
              json.dump(data, f, ensure_ascii=False, indent=2)
        shell: python

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add notas_santiago.json
          git commit -m "Translate titles to English"
          git push
